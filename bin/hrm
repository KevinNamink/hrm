#!/bin/bash
#
# HRM administration script
#
# This file is part of the Huygens Remote Manager
# Copyright and license notice: see license.txt

# hrm.conf defines variable HRM_DATA
. /etc/hrm.conf

if [ "$SUSER" = "" ]
then
    CMD=""
else
    CMD="sudo -u $SUSER"
fi

create() {
    if [ ! -d "$HRM_DATA"/"$1" ]
    then
        $CMD mkdir -p "$HRM_DATA"/"$1"
        $CMD mkdir -p "$HRM_DATA"/"$1"/"$HRM_SOURCE"
        $CMD mkdir -p "$HRM_DATA"/"$1"/"$HRM_DEST"
        # sudo -u "$SUSER" chown -R "$2":users "$HRM_DATA"/"$1"
        $CMD chmod -R 0777 "$HRM_DATA"/"$1"
    else
        if [ ! -d "$HRM_DATA"/"$1"/"$HRM_SOURCE" ]
        then
            $CMD mkdir -p "$HRM_DATA"/"$1"/"$HRM_SOURCE"
        fi

        if [ ! -d "$HRM_DATA"/"$1"/"$HRM_DEST" ]
        then
            $CMD mkdir -p "$HRM_DATA"/"$1"/"$HRM_DEST"
        fi
        # sudo -u "$SUSER" chown -R "$2":users "$HRM_DATA"/"$1"
        $CMD chmod -R 0777 "$HRM_DATA"/"$1"
    fi
}

delete() {
    if [ -d "$HRM_DATA"/"$1" ]
    then
        $CMD rm -R "$HRM_DATA"/"$1"
    fi
}

case "$1" in
    create)
        create "$2"
        ;;
    delete)
        delete "$2"
        ;;
    *)
        echo $"Usage: $0 {create|delete} username"
esac
